<html>
<head>

<style>
@font-face {
  font-family: 'katahdin';
  src: url('fonts/katahdin-round.regular.otf');
}

body {
    font-family: katahdin, sans-serif;
}

div {
    -moz-user-select: none;
    -khtml-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.pile {
  width: 260px;
  height: 200px;
  perspective: 600px;
  display:inline-block;
  margin-right: 20px;
  margin-bottom: 250px;
}

.card {
  position: absolute;
  width: 100%;
  height: 100%;
  top:0;
  left:0;
  cursor: pointer;
  transform-style: preserve-3d;
  transition: transform 0.75s;
  background-color:white;
}

.topcard {
  z-index:1000;
}

.flipped {
  transform: translateY(210px) rotateX(-180deg);
}

.cardface {
  position: absolute;
  width: 100%;
  height: 100%;
  line-height: 200px;
  color: white;
  text-align: center;
  font-weight: bold;
  font-size: 40px;
  backface-visibility: hidden;
  border-radius:10px;
  opacity:1;
}

.card_front {
  background: white;
  border:2px solid black;
  background: url('EXPLO_logo.png');
  background-repeat: no-repeat;
  background-position: center;  
  background-size: 80%;
}

.card_back {
  background: white;
  color: #f79320;
  border:2px solid black;
  transform: rotateX(180deg);
}

</style>

</head>
<body>
<script>
function createPile(id) {
    const pile = document.createElement("div");
	pile.id = id;
	pile.classList.add("pile");
	document.body.append(pile);
}

function createCard(text, pile, idx) {
  const card = document.createElement("div");
  card.classList.add("card");
  card.style.zIndex = "" + (idx+1);
  
  const front = document.createElement("div");
  front.classList.add("cardface");
  front.classList.add("card_front");
  front.innerHTML = " ";
  
  const back = document.createElement("div");
  back.classList.add("cardface");
  back.classList.add("card_back");
  back.innerHTML = text;
  
  card.appendChild(front);
  card.appendChild(back);
  
  card.addEventListener("click", function() {
    const pileElt = document.getElementById(pile);
    const top = pileElt.querySelector(".topcard");
	if (top) {
	    const numFlipped = pileElt.getElementsByClassName("flipped").length;
	    const numInPile = pileElt.getElementsByClassName("card").length;
		if (top.classList.contains("flipped")) {
		    top.style.zIndex = "" + numFlipped;
		} else {
		    top.style.zIndex = "" + (numInPile-numFlipped); 
		}
		top.classList.remove("topcard");
	}
  
    card.style.zIndex = "";
    card.classList.add("topcard");
    card.classList.toggle("flipped");
	var zIndex = parseInt(card.style.zIndex);
  })
  document.getElementById(pile).append(card);
}

function getCards() {
  const url = "https://sheets.googleapis.com/v4/spreadsheets/1a9HyQ1r1_iGDfEVLCThb1aHafm2t5WmImZN0JPw-4P4/values/Sheet1?key=AIzaSyDOUQdHsH-KQZje1ipkNGowjA_fvXfipak&majorDimension=COLUMNS";
  var xhr = new XMLHttpRequest();
  xhr.responseType = "json";
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      addCardsToPiles(xhr.response);
    }
  }

  xhr.open('GET', url, true);
  xhr.send('');
}

function addCardsToPiles(cardData) {
    for (let i = 0; i < cardData.values.length; i++) {
	    const pileName = "pile" + i;
		createPile(pileName);
	    const names = cardData.values[i];
		for (let j = 0; j < names.length; j++) {
			const name = names[j];
			createCard(name, pileName, j);
		}
	}

}

getCards();

</script>

</body>
</html>